<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SCHOOL-OVERRIDE</title>
<style>
  body { margin:0; background:black; color:white; font-family:Arial,sans-serif; height:100vh; display:flex; flex-direction:column; }
  .top-bar { display:flex; justify-content:space-evenly; align-items:center; border:2px solid white; border-radius:40px; padding:10px 20px; background:black; margin:15px auto; max-width:700px; position:relative; z-index:10; }
  .top-bar button { background:none; border:none; color:white; padding:8px 16px; cursor:pointer; font-size:16px; }
  .top-bar button:hover { color:red; }
  #content-frame { flex:1; width:100%; border:none; }

  .dropdown { position:relative; display:inline-block; }
  .dropdown-content { display:none; position:absolute; top:40px; left:0; background:#222; border:2px solid #444; border-radius:8px; min-width:200px; padding:10px; z-index:20; gap:10px; }
  .dropdown:hover .dropdown-content { display:flex; }
  .dropdown-content button { background:#333; border:2px solid #555; border-radius:6px; color:white; padding:8px 12px; cursor:pointer; }
  .dropdown-content button:hover { background:white; color:black; }
  .secondary-dropdown { display:none; position:absolute; top:100%; left:0; margin-top:5px; background:#222; border:2px solid #444; border-radius:8px; flex-direction:column; padding:8px; }
  .dropdown-content .character-ai:hover .secondary-dropdown { display:flex; }
  .secondary-dropdown button { width:100%; margin-top:5px; }

  #overlay, #games-modal { display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.95); z-index:9999; justify-content:center; align-items:center; }
  #overlay iframe { width:90%; height:90%; border:none; border-radius:10px; background:black; }
  #close-overlay, #close-games { position:absolute; top:20px; right:30px; font-size:30px; color:red; cursor:pointer; font-weight:bold; }

  #games-modal .games-box { background:black; border:2px solid white; border-radius:10px; width:600px; height:70vh; display:flex; flex-direction:column; overflow:hidden; }
  .games-search { padding:10px; border-bottom:2px solid white; background:#111; }
  .games-search input { width:100%; padding:8px; border:2px solid white; background:black; color:white; border-radius:6px; }
  .games-list { flex:1; overflow-y:auto; padding:10px; display:flex; flex-direction:column; gap:8px; }
  .games-list button { background:#222; border:2px solid #555; color:white; padding:10px; border-radius:6px; cursor:pointer; text-align:left; }
  .games-list button:hover { background:white; color:black; }

  #beta-label { position:fixed; bottom:5px; right:10px; font-size:12px; color:white; z-index:10000; font-family:monospace; }
</style>
</head>
<body>

<div class="top-bar">
  <button id="games-btn">Games</button>
  <div class="dropdown">
    <button>Ai</button>
    <div class="dropdown-content">
      <button id="ai-bot-btn">Ai Bot</button>
      <div class="character-ai">
        <button>Character Ai</button>
        <div class="secondary-dropdown">
          <button id="cai-btn">C.ai.l</button>
          <button id="polybuzz-btn">PolyBuzz</button>
        </div>
      </div>
    </div>
  </div>
  <button id="media-btn">Media Player</button>
</div>

<iframe id="content-frame"></iframe>

<div id="overlay">
  <div id="close-overlay">✖</div>
  <iframe id="overlay-iframe"></iframe>
</div>

<div id="games-modal">
  <div id="close-games">✖</div>
  <div class="games-box">
    <div class="games-search">
      <input type="text" id="game-search" placeholder="Search games...">
    </div>
    <div class="games-list" id="games-list"></div>
  </div>
</div>

<div id="beta-label">V:1.0</div>

<script>
const homepageIframe = document.getElementById('content-frame');
const overlay = document.getElementById('overlay');
const overlayIframe = document.getElementById('overlay-iframe');
const closeOverlay = document.getElementById('close-overlay');

const gamesModal = document.getElementById('games-modal');
const closeGames = document.getElementById('close-games');
const gamesList = document.getElementById('games-list');
const gameSearch = document.getElementById('game-search');

// Load homepage
fetch('https://raw.githubusercontent.com/NOTAHACKER9999/SCHOOL-OVERRIDE/refs/heads/main/School%20Override/Parts/Proxy%20Broswers/Duckduckgo.html')
  .then(r => r.text()).then(html => homepageIframe.srcdoc = html);

// Overlay function
function openOverlay(link){
  overlay.style.display='flex';
  fetch(link).then(r=>r.text()).then(html=>overlayIframe.srcdoc = html);
  localStorage.setItem('lastGame', link); // save progress
}

// AI buttons
document.getElementById('ai-bot-btn').addEventListener('click', ()=>openOverlay("https://raw.githubusercontent.com/NOTAHACKER9999/SCHOOL-OVERRIDE/refs/heads/main/School%20Override/Parts/Ai/Ai%20bot.html"));
document.getElementById('cai-btn').addEventListener('click', ()=>openOverlay("https://raw.githubusercontent.com/NOTAHACKER9999/SCHOOL-OVERRIDE/refs/heads/main/School%20Override/Parts/Ai/C.ai.l.html"));
document.getElementById('polybuzz-btn').addEventListener('click', ()=>openOverlay("https://raw.githubusercontent.com/NOTAHACKER9999/SCHOOL-OVERRIDE/refs/heads/main/School%20Override/Parts/Ai/PolyBuzz.html"));

// Media player
document.getElementById('media-btn').addEventListener('click', ()=>openOverlay("https://raw.githubusercontent.com/NOTAHACKER9999/SCHOOL-OVERRIDE/refs/heads/main/School%20Override/Parts/Media%20Player.html"));
closeOverlay.addEventListener('click', ()=>{overlay.style.display='none'; overlayIframe.srcdoc='';});

// Games panel - fast lazy-load as each file is found
async function loadGamesFast(filter=""){
    gamesList.innerHTML = '';
    try{
        const res = await fetch('https://api.github.com/repos/NOTAHACKER9999/SCHOOL-OVERRIDE/contents/School%20Override/Parts/Games');
        const data = await res.json();
        if(!Array.isArray(data)) return;

        const uniqueGames = new Map();
        data.forEach(f => {
            if(f.name.endsWith(".html") && !uniqueGames.has(f.name)){
                uniqueGames.set(f.name, f.download_url);
            }
        });

        const gameArray = Array.from(uniqueGames.entries())
            .map(([name, link]) => ({name: name.replace(".html",""), link}))
            .filter(g => g.name.toLowerCase().includes(filter.toLowerCase()));

        // Load in small chunks to avoid UI freeze
        const chunkSize = 5;
        for(let i=0; i<gameArray.length; i+=chunkSize){
            const chunk = gameArray.slice(i, i+chunkSize);
            chunk.forEach(g => {
                const btn = document.createElement('button');
                btn.textContent = g.name;
                btn.addEventListener('click', ()=>{
                    openOverlay(g.link);
                    gamesModal.style.display='none';
                });
                gamesList.appendChild(btn);
            });
            await new Promise(r=>setTimeout(r, 50)); // allow UI to render
        }

        const savedSearch = localStorage.getItem('lastSearch');
        if(savedSearch) gameSearch.value = savedSearch;

    } catch(err){
        console.error(err);
        gamesList.innerHTML="<p style='color:red'>Failed to load games.</p>";
    }
}

// Event listeners
document.getElementById('games-btn').addEventListener('click', ()=>{
    gamesModal.style.display='flex';
    loadGamesFast(gameSearch.value);
});

gameSearch.addEventListener('input', (e)=>{
    const val = e.target.value;
    localStorage.setItem('lastSearch', val);
    loadGamesFast(val);
});

closeGames.addEventListener('click', ()=>{gamesModal.style.display='none';});
</script>
</body>
</html>
