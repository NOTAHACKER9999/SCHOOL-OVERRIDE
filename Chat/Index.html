<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GLITCHED OVERRIDE T/C</title>
<style>
body { margin:0; font-family:sans-serif; background:black; color:red; height:100vh; display:flex; flex-direction:column; }
header { padding:20px; font-size:1.5em; background:#111; border-bottom:1px solid red; text-align:center; font-weight:bold; }
#app { flex:1; position:relative; overflow:hidden; }
.screen { position:absolute; top:0; left:0; width:100%; height:100%; transform:translateX(100%); transition:transform 0.3s ease; }
.active { transform:translateX(0); }
#nav { display:flex; justify-content:space-around; background:#111; border-top:1px solid red; }
#nav button { flex:1; padding:12px; color:red; background:none; border:none; cursor:pointer; font-size:1em; }
.item { margin:6px; padding:12px; background:#111; border-radius:12px; border:1px solid red; display:flex; justify-content:space-between; align-items:center; }
.online { color:lime; } .offline { color:gray; }
#chat-view { position:absolute; top:0; left:100%; width:100%; height:100%; background:black; display:flex; flex-direction:column; transition:transform 0.3s ease; }
#chat-header { display:flex; align-items:center; padding:15px; background:#111; border-bottom:1px solid red; }
#back-btn, #call-btn { background:none; border:none; color:red; font-size:1.2em; cursor:pointer; }
#back-btn { margin-right:10px; }
#call-btn { margin-left:auto; }
#messages { flex:1; overflow-y:auto; padding:10px; }
#chat-footer { display:flex; border-top:1px solid red; }
#chat-footer input { flex:1; padding:10px; background:#111; border:none; color:red; }
#chat-footer button { background:red; border:none; padding:10px; color:black; cursor:pointer; }
</style>
</head>
<body>

<header id="title">GLITCHED OVERRIDE T/C</header>

<div id="app">
  <div id="chats" class="screen active">
    <div id="chatList" style="padding:10px;">No chats yet</div>
  </div>

  <div id="contacts" class="screen">
    <div style="padding:10px;">
      <input id="contactId" placeholder="Enter contact ID"/>
      <button onclick="addContact()">Add</button>
      <div id="contactsList"></div>
    </div>
  </div>

  <div id="profile" class="screen">
    <div style="padding:20px;">
      <p style="font-size:1.4em; font-weight:bold; color:red;" id="myname"></p>
      <p><b>Your ID:</b> <span id="myid"></span></p>
      <input id="newname" placeholder="Change display name"/>
      <button onclick="rename()">Save</button>
    </div>
  </div>

  <div id="chat-view">
    <div id="chat-header">
      <button id="back-btn" onclick="closeChat()">‚Üê</button>
      <span id="chatTitle"></span>
      <button id="call-btn" onclick="callUser()">üìû</button>
    </div>
    <div id="messages"></div>
    <div id="chat-footer">
      <input id="msgInput" placeholder="Type a message"/>
      <button onclick="sendMsg()">Send</button>
    </div>
  </div>
</div>

<div id="nav">
  <button onclick="switchTab(0)">Chats</button>
  <button onclick="switchTab(1)">Contacts</button>
  <button onclick="switchTab(2)">Profile</button>
</div>

<script>
const WORKER_URL = "https://glitched-override-remote-chat.th15isar0bothi.workers.dev";

let screens = ["chats","contacts","profile"];
let currentTab=0;
function switchTab(i){ screens.forEach((s,idx)=>{document.getElementById(s).classList.remove("active"); if(idx===i)document.getElementById(s).classList.add("active"); }); currentTab=i; }

// Profile
let userId=localStorage.getItem("userId")||Math.random().toString(36).slice(2,10);
localStorage.setItem("userId",userId);
let displayName=localStorage.getItem("displayName")||userId;
document.getElementById("myname").textContent=displayName;
document.getElementById("myid").textContent=userId;

// Contacts
let contacts=JSON.parse(localStorage.getItem("contacts")||"[]");
renderContacts();

async function addContact(){
  let contactInput=document.getElementById("contactId");
  let contactId=contactInput.value.trim();
  if(!contactId) return alert("Enter a valid ID");
  if(contactId===userId) return alert("Cannot add yourself");
  if(contacts.includes(contactId)) return alert("Contact already exists");

  try{
    const res=await fetch(`${WORKER_URL}/check?id=${contactId}`);
    const data=await res.json();
    if(!data.exists) return alert("Contact does not exist online");
  }catch(e){ return alert("Error checking contact"); }

  contacts.push(contactId);
  localStorage.setItem("contacts",JSON.stringify(contacts));
  contactInput.value="";
  renderContacts();
}

function removeContact(id){ contacts=contacts.filter(c=>c!==id); localStorage.setItem("contacts",JSON.stringify(contacts)); renderContacts(); }
function renderContacts(){
  const list=document.getElementById("contactsList"); list.innerHTML="";
  if(contacts.length===0){ list.innerHTML="<p>No contacts yet</p>"; return; }
  contacts.forEach(id=>{ const div=document.createElement("div"); div.className="item"; div.innerHTML=`<span>${id}</span><button onclick="removeContact('${id}')">Remove</button>`; list.appendChild(div); });
}

// Profile rename
function rename(){ let newName=document.getElementById("newname").value.trim(); if(newName){ displayName=newName; localStorage.setItem("displayName",newName); document.getElementById("myname").textContent=newName; alert("Name updated!"); } }

// Chat window placeholders
let currentChat="";
function closeChat(){ document.getElementById("chat-view").style.transform="translateX(100%)"; }
function sendMsg(){ 
  let msg=document.getElementById("msgInput").value.trim(); if(!msg) return;
  appendMessage(displayName,msg); 
  document.getElementById("msgInput").value="";
  if(socket && currentChat){ socket.send(JSON.stringify({type:"chat",to:currentChat,text:msg})); }
}
function callUser(){ if(socket && currentChat) socket.send(JSON.stringify({type:"call",to:currentChat})); alert("Calling "+currentChat); }
function appendMessage(from,text){ const m=document.createElement("div"); m.textContent=from+": "+text; document.getElementById("messages").appendChild(m); }

// Connect WebSocket
let socket=new WebSocket(`${WORKER_URL.replace(/^http/,"ws")}/ws?id=${userId}`);
socket.onmessage=function(e){ try{ const msg=JSON.parse(e.data); if(msg.type==="chat"){ if(msg.from===currentChat){ appendMessage(msg.from,msg.text); } else { alert("New message from "+msg.from); } } if(msg.type==="call"){ alert(msg.from+" is calling you!"); } }catch{} };
</script>
</body>
        </html>
