<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GLITCHED OVERRIDE T/C</title>
<style>
body { margin:0; font-family:sans-serif; background:black; color:red; height:100vh; display:flex; flex-direction:column; }
header { padding:20px; font-size:1.5em; background:#111; border-bottom:1px solid red; text-align:center; font-weight:bold; }
#app { flex:1; position:relative; overflow:hidden; }
.screen { position:absolute; top:0; left:0; width:100%; height:100%; transform:translateX(100%); transition:transform 0.3s ease; }
.active { transform:translateX(0); }
#nav { display:flex; justify-content:space-around; background:#111; border-top:1px solid red; }
#nav button { flex:1; padding:12px; color:red; background:none; border:none; cursor:pointer; font-size:1em; }
.item { margin:6px; padding:12px; background:#111; border-radius:12px; border:1px solid red; display:flex; justify-content:space-between; align-items:center; }
.online { color:lime; } .offline { color:gray; }
</style>
</head>
<body>

<header id="title">GLITCHED OVERRIDE T/C</header>

<div id="app">
  <!-- Chats Screen -->
  <div id="chats" class="screen active">
    <div style="padding:10px;" id="chatList">No chats yet</div>
  </div>

  <!-- Contacts Screen -->
  <div id="contacts" class="screen">
    <div style="padding:10px;">
      <input id="contactId" placeholder="Enter contact ID"/>
      <button onclick="addContact()">Add</button>
      <div id="contactsList"></div>
    </div>
  </div>

  <!-- Profile Screen -->
  <div id="profile" class="screen">
    <div style="padding:20px;">
      <p style="font-size:1.4em; font-weight:bold; color:red;" id="myname"></p>
      <p><b>Your ID:</b> <span id="myid"></span></p>
      <input id="newname" placeholder="Change display name"/>
      <button onclick="rename()">Save</button>
    </div>
  </div>
</div>

<div id="nav">
  <button onclick="switchTab(0)">Chats</button>
  <button onclick="switchTab(1)">Contacts</button>
  <button onclick="switchTab(2)">Profile</button>
</div>

<script>
let screens = ["chats","contacts","profile"];
let currentTab = 0;

function switchTab(i) {
  screens.forEach((s,idx)=>{
    document.getElementById(s).classList.remove("active");
    if(idx===i) document.getElementById(s).classList.add("active");
  });
  currentTab = i;
}

// Profile setup
let userId = localStorage.getItem("userId") || Math.random().toString(36).slice(2,10);
localStorage.setItem("userId", userId);
let displayName = localStorage.getItem("displayName") || userId;
document.getElementById("myname").textContent = displayName;
document.getElementById("myid").textContent = userId;

// Contacts
let contacts = JSON.parse(localStorage.getItem("contacts")||"[]");
renderContacts();

async function addContact() {
  let contactInput = document.getElementById("contactId");
  let contactId = contactInput.value.trim();
  if (!contactId) return alert("Enter a valid ID");
  if (contactId === userId) return alert("Cannot add yourself");
  if (contacts.includes(contactId)) return alert("Contact already exists");

  // Validate with Cloudflare Worker
  try {
    const res = await fetch(`/check?id=${contactId}`);
    const data = await res.json();
    if (!data.exists) return alert("Contact does not exist online");
  } catch(err) { return alert("Error checking contact"); }

  contacts.push(contactId);
  localStorage.setItem("contacts", JSON.stringify(contacts));
  contactInput.value = "";
  renderContacts();
}

function removeContact(id) {
  contacts = contacts.filter(c => c !== id);
  localStorage.setItem("contacts", JSON.stringify(contacts));
  renderContacts();
}

function renderContacts() {
  const list = document.getElementById("contactsList");
  list.innerHTML = "";
  if (contacts.length===0) {
    list.innerHTML = "<p>No contacts yet</p>";
    return;
  }
  contacts.forEach(id=>{
    const div = document.createElement("div");
    div.className="item";
    div.innerHTML = `<span>${id}</span><button onclick="removeContact('${id}')">Remove</button>`;
    list.appendChild(div);
  });
}

// Profile rename
function rename() {
  let newName = document.getElementById("newname").value.trim();
  if(newName){
    displayName = newName;
    localStorage.setItem("displayName", newName);
    document.getElementById("myname").textContent = newName;
    alert("Name updated!");
  }
}
</script>

</body>
</html>
